<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
</head>
<script>
    function inc(sender, value) {
        let price = parseInt($(sender).parent().siblings().eq(2).text())
        let quantity = parseInt($(sender).parent().siblings().eq(3).text())
        quantity += value
        if (quantity == 0) {
            del(sender)
        } else {
            let total = price * quantity
            $(sender).parent().siblings().eq(3).text(quantity)
            $(sender).parent().siblings().eq(4).text(total)
            console.log(price)
        }
    }

    let whichButton
    function del(sender) {

        $('#dialog').dialog('open')
        whichButton = sender

    }


    $(() => {
        $('#dialog').dialog({
            autoOpen: false, // é è¨­æœƒè‡ªå‹•é¡¯ç¤ºï¼Œæ‰€ä»¥è¨­å®šç‚ºfalseï¼Œä¸€é–‹å§‹é–‹ç¶²é ä¸æœƒè·³å‡ºä¾†
            buttons: {
                'ç¢ºå®š': function () {
                    $(whichButton)
                        .parent()
                        .parent()
                        .animate({
                            opacity: 0
                        }, 400, function () {
                            $(whichButton)
                                .parent()
                                .parent()
                                .remove()

                        })
                    $(this).dialog('close')


                },
                'å–æ¶ˆ': function () {
                    $(this).dialog('close')
                }
            }
        })

        $.ajax({
            method: 'get',
            url: 'https://raw.githubusercontent.com/kirkchu/mongodb/main/product.json',
            success: function (result) {
                let jsonObj = JSON.parse(result)
                let s = `
               <table border="1">
                   <tr>
                       <th>åœ–ç‰‡</th>
                       <th>é …ç›®</th>
                       <th>å–®åƒ¹</th>
                       <th>æ•¸é‡</th>
                       <th>å°è¨ˆ</th>
                       <th>æ“ä½œ</th>
                   </tr>
           `
                $.each(jsonObj, function (index, product) {
                    s += `
                   <tr id="${product.pid}">
                       <td><img src="${product.image}" width="100"></td>
                       <td>${product.name}</td>
                       <td>${product.price}</td>
                       <td>${product.quantity}</td>
                       <td>${product.price * product.quantity}</td>
                       <td>
                           <button onclick="inc(this, 1)">+</button>
                           <button onclick="inc(this, -1)">-</button>
                           <button onclick="del(this)">ğŸ—‘ï¸</button>
                       </td>
                   </tr>
               `
                })
                s += '</table>'
                $('#product').html(s)
            }
        })
    })   
</script>

<body>
    <div id="product"></div>

    <div id="dialog" title="è³¼ç‰©è»Šæ“ä½œ">
        æ˜¯å¦ç¢ºå®šåˆªé™¤æ­¤ç”¢å“ï¼Ÿ
    </div>

</body>

</html>